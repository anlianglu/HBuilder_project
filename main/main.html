<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">

			<a id="info" class="mui-icon  mui-icon-gear  mui-pull-right" href="setting.html"></a>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view">

			</ul>
		</div>

		<script src="../js/mui.min.js"></script>
		<script src="../js/loadXml.js"></script>
		<script type="text/javascript">
			mui.init({
				preloadPages: [{
					id: 'second.html',
					url: 'second.html'
				}]
			})

			//设置本地存储标志
			localStorage.setItem("isfirst", 1);

			var xmlDoc = checkXMLDocObj('../shu.xml');
			var nodes = xmlDoc.getElementsByTagName('section');
			var ul = document.querySelector('.mui-table-view');
			mui.ready(function() {
				console.log("=================ready=================");
				console.log(xmlDoc);
				console.log(nodes);
				console.log("nodes.length=" + nodes.length);

				var partTitle = nodes[0].getElementsByTagName("part");

				console.log("partTitle.length = " + partTitle.length);
				console.log(partTitle);

				var unitTitle = nodes[0].getElementsByTagName("part")[0];
				console.log(unitTitle);
				
				var unitTitlestr = nodes[0].getElementsByTagName("part")[0].getElementsByTagName("unit");
				console.log("unitTitlestr.length=" + unitTitlestr.length);
				
				for(var i = 0; i < unitTitlestr.length; i++) {
					
					var nuit = unitTitlestr[i].getAttribute("title")
					console.log("nuit = "+nuit);
					var point = unitTitlestr[i].getElementsByTagName("point");
					//console.log(point);
					//console.log(point[0].innerHTML);
				}
				
				
				
				
				for(var i = 0; i < nodes.length; i++) {
					var Part = xmlDoc.getElementsByTagName("section")[i].getAttribute("title");
					var li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					var a = document.createElement('a');
					a.className = 'mui-navigate-right';
					a.innerHTML = Part;

					var index = "" + (i);
					//console.log("index = "+index);	
					li.id = "index" + index;
					li.appendChild(a);
					ul.appendChild(li);
					//console.log(ul.innerHTML);	
				}
				console.log(ul.innerHTML);

			});

			mui.plusReady(function() {
				var backButtonPress = 0;
				mui.back = function(event) {
					backButtonPress++;
					if(backButtonPress > 1) {
						plus.runtime.quit();
					} else {
						plus.nativeUI.toast('再按一次退出应用');
					}
					setTimeout(function() {
						backButtonPress = 0;
					}, 1000);
					return false;
				};
				var detail = null;
				mui(ul).on('tap', '.mui-table-view-cell', function() {
					console.log(" ready  list touch is ok!");
					var idtitle = this.getAttribute("id");
					console.log(idtitle);
					if(!detail) {
						detail = plus.webview.getWebviewById('second.html');
					}
					//传值给详情页面，通知加载新数据
					mui.fire(detail, 'titleId', {
						id: idtitle
					});
					//打开新闻详情
					mui.openWindow({
						id: 'second.html',
						url: 'second.html',
						createNew: false
					});

				});

			});
		</script>
	</body>

</html>